<div class="me-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3><i class="bi bi-piggy-bank me-2 text-success"></i>Ledger</h3>
        <div class="d-flex">
            <div class="">
                <div class="d-flex flex-column align-items-end me-2">
                    <button class="btn btn-outline-primary position-relative" type="button" data-bs-toggle="collapse"
                        data-bs-target="#filterToolbar" aria-expanded="false" aria-controls="filterToolbar">
                        <i class="bi bi-funnel"></i> Filters
                        <span *ngIf="activeFiltersCount > 0"
                            class="badge bg-danger position-absolute top-0 start-100 translate-middle">
                            {{ activeFiltersCount }}
                        </span>
                    </button>
                    <!-- Filter summary below button -->
                    <div *ngIf="activeFiltersSummary" class="small text-muted mt-1">
                        {{ activeFiltersSummary }}
                    </div>
                </div>
            </div>
            <div class="btn-group me-2" role="group" aria-label="Basic outlined example">
                <button type="button" class="btn btn-outline-primary"><i class="bi bi-list"></i></button>
                <button type="button" class="btn btn-outline-primary"><i class="bi bi-card-heading"></i></button>
            </div>
            <div class="ms-2">
                <button class="btn btn-primary ms-2" (click)="refreshData()">
                    <i class="bi bi-arrow-clockwise me-2"></i>Refresh Ledger
                </button>
            </div>
        </div>
    </div>

    <!-- Filter Toolbar -->
    <div class="filter-toolbar bg-light sticky-top p-3 rounded shadow-sm mb-3">
        <div class="row g-3 align-items-end">
            <!-- Time Period -->
            <div class="col-md-3">
                <label class="form-label">Time Period</label>
                <select class="form-select" [(ngModel)]="filters.timePeriod">
                    <option value="today">Today</option>
                    <option value="thisWeek">This Week</option>
                    <option value="thisMonth">This Month</option>
                    <option value="thisQuarter">This Quarter</option>
                    <option value="thisYear">This Year</option>
                    <option value="lastWeek">Last One Week</option>
                    <option value="lastMonth">Last One Month</option>
                    <option value="lastQuarter">Last One Quarter</option>
                    <option value="lastYear">Last One Year</option>
                </select>
            </div>

            <!-- Transaction Type -->
            <div class="col-md-3">
                <label class="form-label">Transaction Type</label>
                <select class="form-select" [(ngModel)]="filters.type">
                    <option value="all">All</option>
                    <option value="credit">Credit</option>
                    <option value="debit">Debit</option>
                </select>
            </div>

            <!-- Domain -->
            <div class="col-md-3">
                <label class="form-label">Domain</label>
                <select class="form-select" [(ngModel)]="filters.domain">
                    <option value="all">All</option>
                    <option value="job">Job</option>
                    <option value="expense">Expense</option>
                </select>
            </div>

            <!-- Refresh -->
            <div class="col-md-3 text-end">
                <button class="btn btn-primary w-100">
                    <i class="bi bi-funnel me-1"></i> Apply Filters
                </button>
            </div>
        </div>
    </div>

    <!-- Summary Section -->
    <div class="row text-center mb-3">
        <div class="col-md-4 mb-2">
            <div class="card shadow-sm border-success">
                <div class="card-body">
                    <h6>Total Credit</h6>
                    <h4 class="text-success">₹{{ totalCredit }}</h4>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-2">
            <div class="card shadow-sm border-danger">
                <div class="card-body">
                    <h6>Total Debit</h6>
                    <h4 class="text-danger">₹{{ totalDebit }}</h4>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-2">
            <div class="card shadow-sm"
                [ngClass]="{'border-success': netEarnings >= 0, 'border-danger': netEarnings < 0}">
                <div class="card-body">
                    <h6>Net Earnings</h6>
                    <h4 [ngClass]="{'text-success': netEarnings >= 0, 'text-danger': netEarnings < 0}">
                        ₹{{ netEarnings }}
                    </h4>
                </div>
            </div>
        </div>
    </div>

    <!-- Transaction Cards -->
    <div class="container-fluid mt-3 px-3 d-none">
        <div class="row g-3">
            <div class="col-12 col-sm-6 col-md-4 col-lg-3" *ngFor="let tx of filteredTransactions">
                <app-transaction-card [ledgerEntry]="tx"></app-transaction-card>
            </div>
        </div>
    </div>
    <div class="table-responsive mt-3">
        <table class="table table-striped table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th>#</th>
                    <th>UUID</th>
                    <th>Description</th>
                    <th>Source</th>
                    <th>Date Time</th>
                    <th>Amount ₹</th>
                    <th>Debit/Credit</th>
                    <th class="text-end">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let ledgerEntry of filteredTransactions; let i = index" class="cursor-pointer">
                    <td>{{ i + 1 }}</td>
                    <td>{{ ledgerEntry.uuid }}</td>
                    <td>{{ ledgerEntry.description }}</td>
                    <td>{{ ledgerEntry.ledgerSource }}</td>
                    <td>{{ ledgerEntry.transactionDateTime }}</td>
                    <td> @if(ledgerEntry.ledgerType === 'CREDIT'){
                        <span class="text-success">+</span>
                        }
                        @else {
                        <span class="text-danger">-</span>
                        }
                        <span [ngClass]="ledgerEntry?.ledgerType === 'CREDIT' ? 'text-success' : 'text-danger'">
                            {{ ledgerEntry?.amount }}
                        </span>
                    </td>
                    <td><span class="badge text-capitalize"
                            [ngClass]="ledgerEntry?.ledgerType === 'CREDIT' ? 'bg-success' : 'bg-danger'">
                            {{ ledgerEntry.ledgerType }}
                        </span>
                    </td>
                    <!-- Actions -->
                    <td class="text-end" (click)="$event.stopPropagation()">
                        <button class="btn btn-sm btn-outline-primary me-1">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger me-1">
                            <i class="bi bi-trash"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-info">
                            <i class="bi bi-box-arrow-up-right"></i>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>


<app-toast *ngIf="showToast" [type]='toastType' [message]='toastMsg' (closeAction)="hideToastComponent()"></app-toast>