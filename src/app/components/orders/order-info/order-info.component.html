<div class="me-1">
    <div class="d-flex justify-content-between align-items-center pb-2 mt-1 mb-2 border-bottom">
        <h3><i class="bi bi-bag-heart-fill me-2 text-success"></i>Order Info</h3>
        <div class="d-flex">
            <div class="ms-2">
                <!-- Back / Breadcrumb -->
                <div class="mb-3">
                    <a routerLink="/dashboard/orders" class="text-decoration-none">
                        <i class="bi bi-arrow-left"></i> Back to Orders
                    </a>
                </div>
            </div>
        </div>
    </div>

    @if (errorMsg) {
    <div class="d-flex justify-content-center align-items-center mt-5">
        <div class="card shadow-sm border-warning" style="max-width: 520px;">
            <div class="card-body text-center p-4">
                <!-- Icon -->
                <div class="mb-3">
                    <i class="bi bi-exclamation-triangle-fill text-warning fs-1"></i>
                </div>

                <!-- Title -->
                <h5 class="fw-semibold text-warning mb-2">
                    Invalid Order
                </h5>

                <!-- Message -->
                <p class="text-muted mb-3">
                    {{ errorMsg }}
                </p>

                <!-- UUID Input -->
                <div class="mb-2">
                    <div class="input-group">
                        <input type="text" class="form-control text-center" placeholder="Paste order UUID here"
                            [(ngModel)]="enteredUuid" (input)="validateUuid()" />

                        <!-- Paste button -->
                        <button type="button" class="btn btn-outline-secondary" (click)="pasteFromClipboard()"
                            title="Paste from clipboard">
                            <i class="bi bi-clipboard"></i>
                        </button>

                        <!-- Go button -->
                        <button type="button" class="btn btn-warning" [disabled]="!isUuidValid"
                            (click)="navigateWithUuid()">Go</button>
                    </div>
                </div>

                <!-- Inline Validation Error -->
                @if (enteredUuid && !isUuidValid) {
                <div class="text-danger small mb-3">
                    Invalid UUID format
                </div>
                }

                <!-- Actions -->
                <div class="d-flex justify-content-center gap-2">
                    <button class="btn btn-outline-secondary" routerLink="/dashboard/orders">
                        <i class="bi bi-arrow-left"></i> Back to orders
                    </button>

                    <button class="btn btn-warning" (click)="reload()">
                        <i class="bi bi-arrow-clockwise"></i> Reload Page
                    </button>
                </div>

            </div>
        </div>
    </div>
    }
    @else {
    <div class="container-fluid">
        <!-- order Header -->
        <div class="card shadow-sm mb-2">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start border-bottom pb-2 mb-2">
                    <div>
                        <h4>{{ order?.jobTypeName }}
                            <span class="mx-1">|</span>
                            <span class="small">{{order?.jobId}}</span>
                            <span class="mx-1">|</span>
                            <span>{{order?.quantity}}</span>
                        </h4>
                    </div>

                    <div>
                        <button class="btn btn-sm btn-outline-primary me-2" data-bs-toggle="modal"
                            data-bs-target="#orderModal">
                            <i class="bi bi-pencil"></i> Edit
                        </button>
                        <button class="btn btn-sm btn-outline-danger" data-bs-toggle="modal"
                            data-bs-target="#confirmDeleteOrderDialog">
                            <i class="bi bi-trash"></i> Delete
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-3">
            <div class="col-12">
                <strong><i class="bi bi-chat-left-text me-1 text-info"></i>Note</strong>
                <div class="mt-2">
                    <textarea class="w-100 px-2" placeholder="No note" readonly>{{ order?.note }}</textarea>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <ul class="nav nav-tabs mb-3">
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="tab" href="#order-details">
                    Order Details
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#order-description">
                    Order Description
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#order-activity">
                    Order Activity
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#payment-history">
                    Payment History
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#customer-details">
                    Customer Details
                </a>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content">

            <!-- Orders -->
            <div class="tab-pane fade show active" id="order-details">
                <div class="card shadow-sm mb-2">
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <strong><span class="me-1 text-info">#</span>Job Id</strong>
                                <div>{{ order?.jobId || 'N/A'}}</div>
                            </div>

                            <div class="col-md-4">
                                <strong><span class="me-1 text-info">#</span>Job Name</strong>
                                <div>{{order?.jobTypeName}}</div>
                            </div>

                            <div class="col-md-4">
                                <strong><span class="me-1 text-info">#</span>Quantity</strong>
                                <div>{{ order?.quantity }}</div>
                            </div>

                            <div class="col-md-4">
                                <strong><i class="bi bi-calendar-plus me-1 text-info"></i>Date of delivery</strong>
                                <div>{{ order?.dateOfDelivery | date:'short' }}</div>
                            </div>

                            <div class="col-md-4">
                                <strong><i class="bi bi-box me-1 text-info"></i>Order Status</strong>
                                <div>{{ order?.printJobStatus || 'N/A' }}</div>
                            </div>

                            <div class="col-md-4">
                                <strong><i class="bi bi-cash-stack me-1 text-info"></i>Payment Status</strong>
                                <div>{{ order?.paymentStatus || 'N/A' }}</div>
                            </div>

                            <div class="col-md-4">
                                <strong><i class="bi bi-cash me-1 text-info"></i>Total Amount</strong>
                                <div>{{ order?.totalAmount || 'N/A' }}</div>
                            </div>

                            <div class="col-md-4">
                                <strong><i class="bi bi-cash me-1 text-info"></i>Pending Amount</strong>
                                <div>{{ order?.pendingAmount || 'N/A' }}</div>
                            </div>

                            <div class="col-md-4">
                                <strong><i class="bi bi-cash me-1 text-info"></i>Discounted Amount</strong>
                                <div>{{ order?.discountedAmount || 'N/A' }}</div>
                            </div>
                            <div class="col-md-4">
                                <strong><i class="bi bi-journal-bookmark me-1 text-info"></i>Book Number</strong>
                                <div>{{ order?.bookNumber || 'N/A' }}</div>
                            </div>

                            <div class="col-md-4">
                                <strong><i class="bi bi-journal-bookmark me-1 text-info"></i>W-Book Number</strong>
                                <div>{{ order?.wBookNumber || 'N/A' }}</div>
                            </div>

                            <div class="col-md-4">
                                <strong><span class="me-1 text-info">#</span>Order UUID</strong>
                                <div>{{ order?.uuid || 'N/A' }}</div>
                            </div>

                            <div class="col-md-4">
                                <strong><i class="bi bi-person me-1 text-info"></i>Created By</strong>
                                <div>{{ order?.createdBy }}</div>
                            </div>

                            <div class="col-md-4">
                                <strong><i class="bi bi-calendar-plus me-1 text-info"></i>Created At</strong>
                                <div>{{ order?.createdAt | date:'short' }}</div>
                            </div>

                            <div class="col-md-4">
                                <strong><i class="bi bi-calendar-check me-1 text-info"></i>Updated At</strong>
                                <div>{{ order?.updatedAt | date:'short' }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Attached Files -->
            <div class="tab-pane fade" id="order-description">
                <div class="row g-3">
                    <div class="col-12">
                        <strong><i class="bi bi-card-text me-1 text-info"></i>Description</strong>
                        <div class="mt-2">
                            <textarea class="w-100 px-2" placeholder="No description"
                                readonly>{{ order?.description }}</textarea>
                        </div>
                    </div>

                    <div>
                        <strong><i class="bi bi-paperclip me-1 text-info"></i>Attached Files</strong>
                        <div class="mt-2">
                            @if(order?.attachmentIds?.length == 0){
                            <div class="alert alert-warning">
                                No attached files
                            </div>
                            }
                            @else {
                            <div class="alert alert-info">
                                {{order?.attachmentIds?.length}} attached-files
                            </div>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <!-- Activity -->
            <div class="tab-pane fade" id="order-activity">
                <div class="alert alert-secondary">
                    Order activity timeline coming soon.
                </div>
            </div>

            <!-- Payment History -->
            <div class="tab-pane fade" id="payment-history">
                <div class="card shadow-sm mb-2">
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <strong><span class="mx-1 text-info">#</span>Total Amount</strong>
                                <div>{{ order?.totalAmount || 'N/A' }}</div>
                            </div>
                            <div class="col-md-4">
                                <strong><span class="mx-1 text-info">#</span>Discounted Amount</strong>
                                <div>{{ order?.discountedAmount || 'N/A' }}</div>
                            </div>
                            <div class="col-md-4">
                                <strong><span class="mx-1 text-info">#</span>Deposited Amount</strong>
                                <div>{{ order?.depositAmount || 'N/A' }}</div>
                            </div>
                            <div class="col-md-4">
                                <strong><span class="mx-1 text-info">#</span>Pending Amount</strong>
                                <div>{{ order?.pendingAmount || 'N/A' }}</div>
                            </div>
                            <div class="col-md-4">
                                <strong><span class="mx-1 text-info">#</span>Payment Status</strong>
                                <div>{{ order?.paymentStatus || 'N/A' }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customer Details -->
            <div class="tab-pane fade" id="customer-details">
                <div class="card shadow-sm mb-2">
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <strong><span class="mx-1 text-info">#</span>Customer Id</strong>
                                <div>{{ order?.customerId || 'N/A' }}</div>
                            </div>
                            <div class="col-md-4">
                                <strong><span class="mx-1 text-info">#</span>Customer Name</strong>
                                <div>{{ order?.customerName || 'N/A' }}</div>
                            </div>
                            <div class="col-md-4">
                                <strong><span class="mx-1 text-info">#</span>Primary Phone Number</strong>
                                <div>{{ order?.customerPrimaryPhone || 'N/A' }}</div>
                            </div>
                            <div class="col-md-4">
                                <strong><span class="mx-1 text-info">#</span>Alternate Phone Number </strong>
                                <div>{{ order?.customerAlternatePhone || 'N/A' }}</div>
                            </div>
                            <div class="col-md-8">
                                <strong><span class="mx-1 text-info">#</span>Customer Address</strong>
                                <div>{{ order?.customerAddress || 'N/A' }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <app-order-modal [model]="order" (successAction)="orderSuccess($event)"
        (errorAction)="orderError($event)"></app-order-modal>
    <app-confirm-dialog [id]="'confirmDeleteOrderDialog'" [title]="'Confirm Delete'" [message]="deleteMsg"
        [confirmText]="'Delete'" [cancelText]="'Cancel'" [confirmBtnClass]="'btn-danger'"
        (confirmed)="deleteCustomer()">
    </app-confirm-dialog>
    <app-toast *ngIf="showToast" [type]='toastType' [message]='toastMsg'
        (closeAction)="hideToastComponent()"></app-toast>
    }
</div>