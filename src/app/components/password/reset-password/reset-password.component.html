<div class="container d-flex justify-content-center align-items-center vh-100">
    @if(!isTokenVerified){
    <div class="fs-2 me-2">
        Verifying token. Please wait.
    </div>
    <div class="spinner-border text-primary" role="status"></div>
    }
    @else if(!isTokenValid) {
    <div class="alert alert-danger">
        <p><strong>Invalid Token</strong></p>
        <p>{{message}}</p>
    </div>
    }
    @else {
    <div class="card shadow p-4" style="max-width: 400px; width: 100%;">
        <!-- Logo -->
        <div class="text-center mb-3">
            <img src="logo/logo_with_text_bg_no.png" alt="App Logo" class="img-fluid" style="max-height: 100px;">
        </div>

        <h3 class="text-center mb-4">Reset Password</h3>
        <form [formGroup]="form" (ngSubmit)="submit()">
            <!-- New Password -->
            <div class="mb-3 position-relative">
                <label for="new-password" class="form-label"><i class="bi bi-person me-1"></i>New Password</label>
                <div class="input-group">
                    <input [type]="showPassword ? 'text' : 'password'" id="new-password" class="form-control"
                        aria-describedby="password-help"
                        [ngClass]="{ 'is-invalid': password?.invalid && password?.touched }"
                        formControlName="password" />
                    <button type="button" class="btn btn-outline-secondary" (click)="togglePassword()">
                        @if(showPassword){
                        <i class="bi bi-eye-slash"></i>
                        }
                        @else{
                        <i class="bi bi-eye"></i>
                        }
                    </button>
                    <div class="invalid-feedback" *ngIf="password?.errors?.['required']">Password is required.</div>
                    <div class="invalid-feedback" *ngIf="password?.errors?.['pattern']">
                        Password must be 8+ chars, include upper, lower, number, special char.
                    </div>
                    <div class="invalid-feedback" *ngIf="password?.errors?.['minlength']">
                        Password must be at least 8 characters long
                    </div>
                    <div *ngIf="password?.errors?.['required']" id="password-help" class="form-text">Password must be 8+
                        chars, include upper, lower, number,
                        special char.</div>
                </div>
            </div>
            <!-- Confirm Password -->
            <div class="mb-3">
                <label for="email" class="form-label"><i class="bi bi-person me-1"></i>Confirm Password</label>
                <input type="password" id="email" class="form-control"
                    [ngClass]="{ 'is-invalid': confirmPassword?.invalid && confirmPassword?.touched }"
                    formControlName="confirmPassword" />
                <div class="invalid-feedback" *ngIf="confirmPassword?.errors?.['required']">
                    Confirm password is required.
                </div>
            </div>
            <!-- Submit/Login Button -->
            <div class="d-flex justify-content-center">
                <button type="submit" class="btn btn-primary" [disabled]="loading">
                    @if(!loading){
                    <span>Submit</span>
                    }
                    @else {
                    <span class="spinner-border spinner-border-sm me-1"></span>
                    <span>Submitting...</span>
                    }
                </button>
            </div>
        </form>
        <!-- Message -->
        <p class="mt-3 alert" [ngClass]="alertClass" *ngIf="message">
            {{ message }}
        </p>
        <div class="mt-3 text-center"><a routerLink="../login">Back to Login</a></div>
    </div>
    }
</div>